#!/usr/local/bin/php
<?php

error_reporting(0);
define('NO_DIRECT_ACCESS', 'true');

require_once(__DIR__ . '/../src/constants.php');
require_once(__DIR__ . '/../src/functions.php');
require_once(__DIR__ . '/../src/autoload.php');
require_once(__DIR__ . '/../vendor/autoload.php');

use Vector\Module\Console\Application;
$application = new Application($argv);

/**
 * @package Vector
 * Command: cache:clear
 */
$application->registerCommand('cache:clear', function(): int {
    $dir = __DIR__ . '/../var/cache/';
    if (file_exists($dir) AND is_dir($dir)) {
        $cacheDir = new RecursiveDirectoryIterator($dir, FilesystemIterator::SKIP_DOTS);
        $iterator = new RecursiveIteratorIterator($cacheDir, RecursiveIteratorIterator::CHILD_FIRST);
        foreach ($iterator as $file) {
            $fname = $file->getFilename();
            if (!preg_match('%\.gitkeep$%', $fname)) { 
                $file->isDir() ?  rmdir($file) : unlink($file);
            }
        }
    }
    return 0;
});

$application->run();
